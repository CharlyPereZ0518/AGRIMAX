<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agrimax - Men√∫ Cliente</title>
    <link rel="stylesheet" href="/static/css/menu.css">
    <link rel="stylesheet" href="/static/css/boton_hamburguesaP.css">
    <script src="/static/js/boton_hamburguesaP.js" defer></script>
    <script src="/static/js/menu_cliente.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/footer.css"> 
    <link rel="stylesheet" href="/static/css/frutas.css">
    <script src="/static/js/frutas.js" defer></script>
    <link rel="stylesheet" href="/static/css/contraste.css">
    <script src="/static/js/accesibilidad.js" defer></script>
    <script src="/static/js/accesibilidad_global.js"></script>
  <!-- Single Accessibility bubble -->
  <div id="accBubble" title="Accesibilidad" style="position:fixed;right:18px;bottom:158px;z-index:14009;width:56px;height:56px;border-radius:50%;background:#0056b3;color:#fff;display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 6px 18px rgba(0,0,0,.25);cursor:pointer"><i class="fas fa-universal-access" aria-hidden="true"></i></div>

  <!-- Accessibility panel (consolidated) -->
  <div id="accPanel" class="accModal" aria-hidden="true">
    <div class="panel">
      <header>
        <span>Accesibilidad</span>
        <div>
          <button onclick="closeAccPanel()" style="background:transparent;border:0;color:#fff;font-size:18px;cursor:pointer">√ó</button>
        </div>
      </header>
      <div class="content">
        <section class="acc-section">
          <h4>Contraste</h4>
          <p>Selecciona nivel de contraste:</p>
          <button class="acc-btn secondary" onclick="setContrast('normal')">Normal</button>
          <button class="acc-btn" onclick="setContrast('alto')">Alto</button>
          <button class="acc-btn" onclick="setContrast('muy-alto')">Muy alto</button>
        </section>

        <section class="acc-section">
          <h4>Modo Lector</h4>
          <p>Activa o desactiva el lector de pantalla:</p>
          <button class="acc-btn" onclick="toggleReader(true)">Activar</button>
          <button class="acc-btn secondary" onclick="toggleReader(false)">Desactivar</button>
        </section>

        <section class="acc-section">
          <h4>Cursor</h4>
          <p>Tama√±o del cursor:</p>
          <button class="acc-btn secondary" onclick="setCursorSize('normal')">Normal</button>
          <button class="acc-btn" onclick="setCursorSize('large')">Grande</button>
        </section>

        <section class="acc-section">
          <h4>Fuente</h4>
          <p>Tama√±o de fuente:</p>
          <button class="acc-btn secondary" onclick="setFontSize('normal')">Normal</button>
          <button class="acc-btn" onclick="setFontSize('large')">Grande</button>
          <button class="acc-btn" onclick="setFontSize('x-large')">Extra grande</button>
        </section>

        <section class="acc-section">
          <h4>Tema</h4>
          <p>Alterna modos:</p>
          <button class="acc-btn" onclick="setTheme('nocturno')">Modo nocturno</button>
          <button class="acc-btn" onclick="setTheme('oscuro')">Modo oscuro</button>
          <button class="acc-btn" onclick="setTheme('grises')">Modo grises</button>
          <button class="acc-btn secondary" onclick="setTheme('normal')">Restablecer</button>
        </section>
      </div>
    </div>
  </div>
                <i class="fas fa-shopping-cart"></i>
                {% if cantidad_total > 0 %}
                <span class="cart-count">{{ cantidad_total }}</span>
                {% endif %}
            </button>
        </div>
    </header>
    <div id="sidebar" class="sidebar">
        <ul class="sidebar-menu">
            <li><a href="{{ url_for('usuarios.perfil', usuario_id=session['usuario_id']) }}">PERFIL</a></li>
            <li>
                <button class="dropdown-btn">CATEGOR√çAS <i class="fas fa-caret-down"></i></button>
                <ul class="dropdown-container">
                    <li><a href="{{ url_for('verduras.verduras') }}">Verduras</a></li>
                    <li><a href="{{ url_for('frutas.frutas') }}">Frutas</a></li>
                    <li><a href="{{ url_for('legumbres.legumbres') }}">Legumbres</a></li>
                    <li><a href="{{ url_for('hortalizas.hortalizas') }}">Hortalizas</a></li>
                </ul>
            </li>
            <li><a href="{{ url_for('configuracion.configuracion') }}">CONFIGURACI√ìN</a></li>
            <li><a href="{{ url_for('logout.logout') }}" class="logout-btn">CERRAR SESI√ìN</a></li>
        </ul>
    </div>

    <div id="overlay" class="overlay"></div>


    <main>
        <h1>Productos Disponibles</h1>
        <br><br>
        <h1 class="main-title">NUESTROS PRODUCTOS DISPONIBLES</h1>

<div class="products-container">
    {% for producto in productos %}
    <div class="product-card" onclick="openModal('{{ producto.id }}')">
        <img src="{{ producto.imagen }}" alt="{{ producto.nombre }}">
        <h3>{{ producto.nombre }}</h3>
    </div>
    {% endfor %}
</div>

{% for producto in productos %}
<div class="product-modal" id="{{ producto.id }}-modal">
    <div class="modal-content">
        <div class="modal-image">
            <img src="{{ producto.imagen }}" alt="{{ producto.nombre }}">
        </div>
        <div class="modal-info">
            <div class="company-name">{{ producto.proveedor }}</div>
            <h2 class="product-title">{{ producto.nombre }}</h2>
            <p class="product-description">{{ producto.descripcion }}</p>
            <div class="pricing-info">
                <div class="price-item"><strong>Precio:</strong> ${{ producto.precio }}</div>
                <div class="price-item"><strong>Categor√≠a:</strong> {{ producto.categoria }}</div>
            </div>
        <form action="{{ url_for('agregar_carrito.agregar_al_carrito') }}" method="POST" class="modal-buttons">
            <input type="hidden" name="producto_id" value="{{ producto.id }}">
            <input type="number" name="cantidad" value="1" min="1" required>
            <button type="submit" class="add-to-cart-btn">Agregar al carrito</button>
        </form>
        </div>
    </div>
    <button class="close-modal" onclick="closeModal('{{ producto.id }}-modal')">√ó</button>
</div>
{% endfor %}

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="flash {{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}
    </main>

    <div id="notificacion" class="notificacion">Producto agregado al carrito ‚úÖ</div>

      <div id="chatBubble" aria-label="Abrir chat" title="Abrir chat">üí¨</div>

  <!-- Chat modal (iframe loads chat page) -->
  <div id="chatModal" aria-hidden="true">
    <div style="width:360px;height:520px;background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.3);overflow:hidden;display:flex;flex-direction:column;">
      <div style="background:linear-gradient(90deg,#2d5a27,#4a8c3a);color:#fff;padding:8px 10px;display:flex;justify-content:space-between;align-items:center;">
        <div>ü§ñ Asistente Agrimax</div>
        <div>
          <button id="chatMinimize" type="button" style="background:transparent;border:0;color:#fff;font-size:18px;cursor:pointer">‚Äî</button>
          <button id="chatClose" type="button" style="background:transparent;border:0;color:#fff;font-size:18px;cursor:pointer">√ó</button>
        </div>
      </div>
      <iframe id="chatIframe"
              src="{{ url_for('chat.chat_page', role='cliente') }}"
              title="Chat Agrimax - Cliente"
              aria-label="Chat Agrimax - Cliente"
              style="border:0;width:100%;height:100%;"></iframe>
    </div>
  </div>
  
  <!-- Accessibility bubbles -->
  <div class="acc-bubbles" aria-hidden="false">
    <div id="accContrast" class="acc-bubble acc-contrast" title="Contraste">C</div>
    <div id="accReader" class="acc-bubble acc-reader" title="Modo lector">R</div>
    <div id="accCursor" class="acc-bubble acc-cursor" title="Cursor">üñ±</div>
    <div id="accFont" class="acc-bubble acc-font" title="Tama√±o fuente">A</div>
    <div id="accTheme" class="acc-bubble acc-theme" title="Tema">‚òº</div>
  </div>

  <!-- Accessibility modals -->
  <div id="accContrastModal" class="accModal" aria-hidden="true">
    <div class="panel">
      <header><span>Contraste</span><button onclick="closeAccModal('accContrastModal')" style="background:transparent;border:0;color:#fff;font-size:18px;cursor:pointer">√ó</button></header>
      <div class="content">
        <p>Selecciona nivel de contraste:</p>
        <button class="acc-btn secondary" onclick="setContrast('normal')">Normal</button>
        <button class="acc-btn" onclick="setContrast('alto')">Alto</button>
        <button class="acc-btn" onclick="setContrast('muy-alto')">Muy alto</button>
      </div>
    </div>
  </div>

  <div id="accReaderModal" class="accModal" aria-hidden="true">
    <div class="panel">
      <header><span>Modo Lector</span><button onclick="closeAccModal('accReaderModal')" style="background:transparent;border:0;color:#fff;font-size:18px;cursor:pointer">√ó</button></header>
      <div class="content">
        <p>Activa o desactiva el lector de pantalla:</p>
        <button class="acc-btn" onclick="toggleReader(true)">Activar</button>
        <button class="acc-btn secondary" onclick="toggleReader(false)">Desactivar</button>
      </div>
    </div>
  </div>

  <div id="accCursorModal" class="accModal" aria-hidden="true">
    <div class="panel">
      <header><span>Tama√±o del cursor</span><button onclick="closeAccModal('accCursorModal')" style="background:transparent;border:0;color:#fff;font-size:18px;cursor:pointer">√ó</button></header>
      <div class="content">
        <p>Selecciona tama√±o del cursor:</p>
        <button class="acc-btn secondary" onclick="setCursorSize('normal')">Normal</button>
        <button class="acc-btn" onclick="setCursorSize('large')">Grande</button>
      </div>
    </div>
  </div>

  <div id="accFontModal" class="accModal" aria-hidden="true">
    <div class="panel">
      <header><span>Tama√±o de fuente</span><button onclick="closeAccModal('accFontModal')" style="background:transparent;border:0;color:#fff;font-size:18px;cursor:pointer">√ó</button></header>
      <div class="content">
        <p>Selecciona tama√±o de fuente:</p>
        <button class="acc-btn secondary" onclick="setFontSize('normal')">Normal</button>
        <button class="acc-btn" onclick="setFontSize('large')">Grande</button>
        <button class="acc-btn" onclick="setFontSize('x-large')">Extra grande</button>
      </div>
    </div>
  </div>

  <div id="accThemeModal" class="accModal" aria-hidden="true">
    <div class="panel">
      <header><span>Tema</span><button onclick="closeAccModal('accThemeModal')" style="background:transparent;border:0;color:#fff;font-size:18px;cursor:pointer">√ó</button></header>
      <div class="content">
        <p>Alterna modos:</p>
        <button class="acc-btn" onclick="setTheme('oscuro')">Modo oscuro</button>
        <button class="acc-btn" onclick="setTheme('grises')">Modo grises</button>
        <button class="acc-btn secondary" onclick="setTheme('normal')">Restablecer</button>
      </div>
    </div>
  </div>
  <script>
    // Menu toggle
    function toggleMenu() {
      var menu = document.getElementById("menuContent");
      if (!menu) return;
      menu.style.display = (menu.style.display === "block") ? "none" : "block";
    }

    // Product modal controls
    function openModal(id) {
      var el = document.getElementById(id + '-modal');
      if (!el) return;
      el.style.display = 'block';
      document.getElementById('overlay').classList.add('active');
    }

    function closeModal(id) {
      var el = document.getElementById(id);
      if (!el) return;
      el.style.display = 'none';
      document.getElementById('overlay').classList.remove('active');
    }

    // Chat bubble / modal controls
    (function(){
      const bubble = document.getElementById('chatBubble');
      const modal = document.getElementById('chatModal');
      const closeBtn = document.getElementById('chatClose');
      const minBtn = document.getElementById('chatMinimize');
      const headerBtn = document.getElementById('open-chat-btn');


      function showModal(){
        if (modal){
          modal.style.display = 'block';
          modal.setAttribute('aria-hidden', 'false');
        }
        if (bubble) bubble.style.display = 'none';
        if (headerBtn) headerBtn.style.display = 'none';
      }
     function hideModal(){
      if (modal){
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden', 'true');
      }
      if(bubble) bubble.style.display = 'flex';
      if(headerBtn) headerBtn.style.display = 'inline-block';
     }

     if (bubble) bubble.addEventListener('click', showModal);
     if (headerBtn) headerBtn.addEventListener('click', showModal);
     if (closeBtn) closeBtn.addEventListener('click', hideModal);
     if (minBtn) minBtn.addEventListener('click', hideModal);

      // allow parent openChatModal() used elsewhere
      window.openChatModal = showModal;
      window.closeChatModal = hideModal;
      window.minimizeChat = hideModal;
    })();

    // Accessibility consolidated panel controls
    (function(){
      var accBubble = document.getElementById('accBubble');
      var accPanel = document.getElementById('accPanel');

      function showAccPanel(){
        if(!accPanel) return;
        accPanel.style.display = 'block';
        accPanel.setAttribute('aria-hidden','false');
      }

      window.closeAccPanel = function(){
        if(!accPanel) return;
        accPanel.style.display = 'none';
        accPanel.setAttribute('aria-hidden','true');
      }

      if(accBubble) accBubble.addEventListener('click', showAccPanel);

      // Expose functions globally so buttons inside panel work
      window.setContrast = function(level){ localStorage.setItem('nivel_contraste', level); location.reload(); };
      window.toggleReader = function(on){ localStorage.setItem('modo_lector', on ? 'on' : 'off'); location.reload(); };
      window.setCursorSize = function(size){ localStorage.setItem('cursor_size', size); location.reload(); };
      window.setFontSize = function(size){ localStorage.setItem('font_size', size); location.reload(); };
      window.setTheme = function(kind){
        if(kind === 'normal'){
          localStorage.removeItem('modo_oscuro');
          localStorage.removeItem('modoOscuro');
          localStorage.removeItem('modoGrises');
          localStorage.removeItem('modo_nocturno');
        } else if(kind === 'oscuro'){
          localStorage.setItem('modo_oscuro','on');
          localStorage.setItem('modoOscuro','on');
          localStorage.removeItem('modoGrises');
          localStorage.removeItem('modo_nocturno');
        } else if(kind === 'nocturno'){
          // 'nocturno' mapea a la variante 'cielo-nocturno' usada en accesibilidad.js
          localStorage.setItem('modoOscuro','cielo-nocturno');
          localStorage.setItem('modo_oscuro','on');
          localStorage.setItem('modo_nocturno','on');
          localStorage.removeItem('modoGrises');
        } else if(kind === 'grises'){
          localStorage.setItem('modoGrises','true');
          localStorage.removeItem('modo_oscuro');
          localStorage.removeItem('modoOscuro');
          localStorage.removeItem('modo_nocturno');
        }
        location.reload();
      };
    })();

    // Improve page restore behavior
    window.onpageshow = function(event) {
      if (event.persisted) {
        window.location.reload();
      }
    };
  </script>
    <script>
  // Aplicar contraste desde localStorage
  const contraste = localStorage.getItem('nivel_contraste') || 'normal';
  const body = document.body;

  // Remover clases previas
  body.classList.remove('contraste-alto', 'contraste-muy-alto', 'modo-oscuro');

  // Aplicar clase seg√∫n contraste
  if (contraste !== 'normal') {
    switch (contraste) {
      case 'alto':
        body.classList.add('contraste-alto');
        break;
      case 'muy-alto':
        body.classList.add('contraste-muy-alto');
        break;
      case 'oscuro':
        body.classList.add('modo-oscuro');
        break;
    }
  }

  // Aplicar modo grises si est√° activado
  if (localStorage.getItem('modoGrises') === 'true') {
    body.classList.add('modo-grises');
  }
</script>

<script>
        function toggleMenu() {
            var menu = document.getElementById("menuContent");
            if (menu.style.display === "block") {
                menu.style.display = "none";
            } else {
                menu.style.display = "block";
            }
        }
    window.onpageshow = function(event) {
        if (event.persisted) {
            window.location.reload();
        }
    };
    function openModal(id) {
        document.getElementById(id + '-modal').style.display = 'block';
        document.getElementById('overlay').classList.add('active');
    }

    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
        document.getElementById('overlay').classList.remove('active');
    }

    window.onpageshow = function(event) {
        if (event.persisted) {
            window.location.reload();
        }
    };
    </script>

</body>
    <footer>
        <p>¬© 2025 AGRIMAX. TODOS LOS DERECHOS RESERVADOS.</p>
    </footer>
</html>