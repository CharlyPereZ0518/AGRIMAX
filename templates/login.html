<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGRIMAX - Inicio de Sesión</title>
    <link rel="stylesheet" href="/static/css/login.css">
    <script src="https://www.google.com/recaptcha/api.js?render={{ site_key }}"></script>
</head>

<body>
    <div class="container">
        {% include '_header.html' %}

        <h1>Bienvenido</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-container">
            {% for category, message in messages %}
            <div class="flash-message {{ category }}">
                <p>{{ message }}</p>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
        <br><br>

        <form method="POST" action="/login" id="loginForm">
            <label for="correo">Correo Electrónico:</label>
            <input type="email" id="correo" name="correo" placeholder="Ingresa tu correo" required>
            <br><br>

            <label for="contraseña">Contraseña:</label>
            <input type="password" id="contraseña" name="contraseña" placeholder="Ingresa tu contraseña" required>
            <br><br>

            <input type="hidden" name="g-recaptcha-response" id="recaptchaResponse">

            <button type="submit">Iniciar Sesión</button>
        </form>
        <br>
        <p class="register">¿No tienes cuenta? <a href="/registro">Regístrate</a></p>
        <p class="register">¿Olvidaste tu contraseña? <a href="{{ url_for('olvido_contrasena.solicitar_reset') }}">Recuperarla</a></p>
        <p class="register"><a href="/">Volver al inicio</a></p>
    </div>

    <script>
        const form = document.getElementById('loginForm');
        
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            grecaptcha.ready(function() {
                grecaptcha.execute('{{ site_key }}', {action: 'login'}).then(function(token) {
                    document.getElementById('recaptchaResponse').value = token;
                    form.submit();
                });
            });
        });
    </script>
</body>

</html>